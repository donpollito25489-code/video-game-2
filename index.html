<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Fortnite â€“ Biomes Update</title>
<style>
body { margin:0; overflow:hidden; cursor:crosshair; }
#ui {
  position:fixed;
  top:10px;
  left:10px;
  color:white;
  font-family:Arial;
  font-size:18px;
}
</style>
</head>
<body>

<div id="ui">
Health: <span id="health">100</span> |
Damage: <span id="dmg">1</span>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
/* ---------- SCENE ---------- */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

/* ---------- LIGHT ---------- */
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const sun = new THREE.DirectionalLight(0xffffff,1);
sun.position.set(50,100,50);
scene.add(sun);

/* ---------- TERRAIN ---------- */
const terrainGeo = new THREE.PlaneGeometry(600,600,80,80);
terrainGeo.rotateX(-Math.PI/2);
terrainGeo.attributes.position.array.forEach((v,i)=>{
  if(i%3===1){
    terrainGeo.attributes.position.array[i] += Math.random()*5;
  }
});
terrainGeo.computeVertexNormals();

const terrain = new THREE.Mesh(
  terrainGeo,
  new THREE.MeshStandardMaterial({color:0x3cb371})
);
scene.add(terrain);

/* ---------- SNOW BIOME ---------- */
const snow = new THREE.Mesh(
  new THREE.PlaneGeometry(300,300),
  new THREE.MeshStandardMaterial({color:0xf0f8ff})
);
snow.rotation.x = -Math.PI/2;
snow.position.set(200,0.2,200);
scene.add(snow);

/* ---------- TREES & ROCKS ---------- */
function tree(x,z,color){
  const trunk = new THREE.Mesh(
    new THREE.CylinderGeometry(0.3,0.4,3),
    new THREE.MeshStandardMaterial({color:0x8b4513})
  );
  const top = new THREE.Mesh(
    new THREE.SphereGeometry(1.5),
    new THREE.MeshStandardMaterial({color})
  );
  trunk.position.set(x,1.5,z);
  top.position.set(x,3.5,z);
  scene.add(trunk,top);
}

for(let i=0;i<40;i++){
  tree(Math.random()*200-100,Math.random()*200-100,0x228b22);
  tree(Math.random()*200+100,Math.random()*200+100,0xffffff);
}

/* ---------- PLAYER ---------- */
function createPlayer(){
  const g=new THREE.Group();
  g.add(new THREE.Mesh(
    new THREE.CapsuleGeometry(0.5,1.2,4,8),
    new THREE.MeshStandardMaterial({color:0x0000ff})
  ));
  const head=new THREE.Mesh(
    new THREE.SphereGeometry(0.4),
    new THREE.MeshStandardMaterial({color:0xffdbac})
  );
  head.position.y=1.5;
  g.add(head);
  return g;
}

const player=createPlayer();
player.position.y=1;
scene.add(player);

/* ---------- CAMERA & MOUSE ---------- */
let yaw=0,pitch=0;
document.body.onclick=()=>document.body.requestPointerLock();

document.addEventListener("mousemove",e=>{
  if(document.pointerLockElement!==document.body)return;
  yaw -= e.movementX*0.002;
  pitch += e.movementY*0.002; // FIXED (not inverted)
  pitch=Math.max(-1,Math.min(1,pitch));
});

/* ---------- INPUT ---------- */
const keys={};
document.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

/* ---------- PHYSICS ---------- */
let vy=0,onGround=true;
const gravity=-0.015;

/* ---------- LOOT & CHESTS ---------- */
let damage=1;
const chests=[];

function chest(x,z){
  const c=new THREE.Mesh(
    new THREE.BoxGeometry(1,1,1),
    new THREE.MeshStandardMaterial({color:0xffd700})
  );
  c.position.set(x,0.5,z);
  scene.add(c);
  chests.push(c);
}
chest(10,10);
chest(-20,15);

/* ---------- ENEMIES ---------- */
const enemies=[],enemyBullets=[];
function spawnEnemy(){
  const e=createPlayer();
  e.children[0].material.color.set(0xff0000);
  e.position.set(Math.random()*80-40,1,Math.random()*80-40);
  scene.add(e);
  enemies.push(e);
}
setInterval(spawnEnemy,4000);

/* ---------- SHOOTING ---------- */
const bullets=[];
document.addEventListener("mousedown",()=>{
  const b=new THREE.Mesh(
    new THREE.SphereGeometry(0.15),
    new THREE.MeshBasicMaterial({color:0xffff00})
  );
  b.position.copy(player.position);
  b.userData.vel=new THREE.Vector3(Math.sin(yaw),0,-Math.cos(yaw)).multiplyScalar(0.7);
  scene.add(b);
  bullets.push(b);
});

/* ---------- STORM ---------- */
let stormRadius=250;
const storm=new THREE.Mesh(
  new THREE.SphereGeometry(stormRadius,32,32),
  new THREE.MeshBasicMaterial({
    color:0x8000ff,
    transparent:true,
    opacity:0.15,
    side:THREE.BackSide
  })
);
scene.add(storm);

/* ---------- UI ---------- */
let health=100;
const hEl=document.getElementById("health");
const dEl=document.getElementById("dmg");

/* ---------- UPDATE ---------- */
function update(){
  const speed=0.15;
  const f=new THREE.Vector3(Math.sin(yaw),0,-Math.cos(yaw));
  const r=new THREE.Vector3(Math.cos(yaw),0,Math.sin(yaw));

  if(keys.w)player.position.add(f.multiplyScalar(speed));
  if(keys.s)player.position.add(f.multiplyScalar(-speed));
  if(keys.a)player.position.add(r.multiplyScalar(-speed));
  if(keys.d)player.position.add(r.multiplyScalar(speed));

  if(keys[" "]&&onGround){vy=0.35;onGround=false;}
  vy+=gravity;
  player.position.y+=vy;
  if(player.position.y<1){player.position.y=1;vy=0;onGround=true;}

  player.rotation.y=yaw;
  camera.position.copy(player.position).add(new THREE.Vector3(
    Math.sin(yaw)*6,3+pitch*2,-Math.cos(yaw)*6
  ));
  camera.lookAt(player.position.x,player.position.y+1.5,player.position.z);

  // Loot pickup
  chests.forEach((c,i)=>{
    if(c.position.distanceTo(player.position)<1.5){
      damage++;
      dEl.textContent=damage;
      scene.remove(c);
      chests.splice(i,1);
    }
  });

  // Enemy AI
  enemies.forEach(e=>{
    const dir=player.position.clone().sub(e.position).normalize();
    e.position.add(dir.multiplyScalar(0.03));
    if(Math.random()<0.01){
      const eb=new THREE.Mesh(
        new THREE.SphereGeometry(0.12),
        new THREE.MeshBasicMaterial({color:0xff0000})
      );
      eb.position.copy(e.position);
      eb.userData.vel=dir.multiplyScalar(0.4);
      scene.add(eb);
      enemyBullets.push(eb);
    }
  });

  // Enemy bullets
  enemyBullets.forEach((b,i)=>{
    b.position.add(b.userData.vel);
    if(b.position.distanceTo(player.position)<1){
      health--;
      hEl.textContent=health;
      scene.remove(b);
      enemyBullets.splice(i,1);
    }
  });

  // Storm
  stormRadius-=0.02;
  storm.scale.setScalar(stormRadius/250);
  if(player.position.length()>stormRadius){
    health-=0.05;
    hEl.textContent=Math.floor(health);
  }
}

function animate(){
  requestAnimationFrame(animate);
  update();
  renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
